(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-012c"],{"+ug9":function(e,t,a){"use strict";var i=a("gqEu");a.n(i).a},"9p7l":function(e,t,a){},QNKK:function(e,t,a){"use strict";a.r(t);var i=a("qkoc"),o=a("rci3"),l=a("4gNM"),s=a("ewrL"),c=a("XWIM"),n=a("GQeE"),r=a.n(n),d=a("FyfS"),u=a.n(d),p=a("P2sY"),h=a.n(p),v={name:"DncChoice",inject:["beforeClose"],components:{ButtonLoading:l.a},props:{protocolList:{type:Array,required:!0},templateList:{type:Array,required:!0},selectedProtocol:{type:Array,required:!0},nextLoading:{type:Boolean,default:!1}},data:function(){return{type:"protocol",checkedProtocolList:[],checkedProtocolMap:{},selectedTemplate:-1,doNext:this.nextLoading,tableMaxHeight:175}},watch:{nextLoading:function(e){this.doNext=e}},created:function(){var e=this;this.initData(this.selectedProtocol),this.$nextTick(function(){document.documentElement.offsetWidth>=1920?e.tableMaxHeight=335:e.tableMaxHeight=175})},methods:{initData:function(e){var t={},a=!0,i=!1,o=void 0;try{for(var l,s=u()(e);!(a=(l=s.next()).done);a=!0){var c=l.value;t[c]=this.selectedProtocol.includes(c)}}catch(e){i=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}this.checkedProtocolMap=h()({},this.checkedProtocolMap,t)},handleCancelClick:function(){this.beforeClose()},handleNextClick:function(){if(this.doNext=!0,"protocol"===this.type){this.checkedProtocolList=[];var e=!0,t=!1,a=void 0;try{for(var i,o=u()(r()(this.checkedProtocolMap));!(e=(i=o.next()).done);e=!0){var l=i.value;this.checkedProtocolMap[l]&&this.checkedProtocolList.push(l)}}catch(e){t=!0,a=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw a}}if(!this.checkedProtocolList.length)return this.$messageTips({type:"error",message:"请先选择协议或模板"}),void(this.doNext=!1);this.$emit("choiceComplete",{type:"protocol",value:this.checkedProtocolList})}else if("template"===this.type){if(!(this.selectedTemplate>=0))return this.$messageTips({type:"error",message:"请先选择协议或模板"}),void(this.doNext=!1);this.$emit("choiceComplete",{type:"template",value:this.selectedTemplate})}}}},m=(a("Zy2D"),a("+ug9"),a("KHd+")),f=Object(m.a)(v,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"choice-container"},[a("button",{staticClass:"close-button",on:{click:e.handleCancelClick}},[a("i",{staticClass:"el-dialog__close el-icon-close"})]),e._v(" "),a("div",{staticClass:"choice-main"},[a("div",{staticClass:"choice-wrapper"},[a("el-radio",{attrs:{label:"protocol"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),e._v(" "),a("div",{staticClass:"choice-panel protocol modify-scroll-bar",class:{disabled:"template"===e.type,active:"protocol"===e.type}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"protocol"!==e.type,expression:"type !== 'protocol'"}],staticClass:"choice-mask"}),e._v(" "),a("div",{staticClass:"choice-head"},[e._v("选择协议")]),e._v(" "),a("div",{staticClass:"choice-body"},[e.protocolList.length?e._l(e.protocolList,function(t,i){return a("div",{key:i,staticClass:"choice-item"},[a("el-checkbox",{staticClass:"protocol-checkbox",attrs:{label:t},model:{value:e.checkedProtocolMap[t],callback:function(a){e.$set(e.checkedProtocolMap,t,a)},expression:"checkedProtocolMap[protocol]"}},[e._v("\n                "+e._s(t)+"\n              ")])],1)}):a("div",{staticClass:"no-protocol"},[e._v("\n            暂无数据\n          ")])],2)])],1),e._v(" "),a("div",{staticClass:"choice-wrapper"},[a("el-radio",{attrs:{label:"template"},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}}),e._v(" "),a("div",{staticClass:"choice-panel template",class:{disabled:"protocol"===e.type,active:"template"===e.type}},[a("div",{directives:[{name:"show",rawName:"v-show",value:"template"!==e.type,expression:"type !== 'template'"}],staticClass:"choice-mask"}),e._v(" "),a("div",{staticClass:"choice-head"},[e._v("选择模版")]),e._v(" "),a("div",{staticClass:"choice-body table-container inside-table"},[a("el-table",{attrs:{data:e.templateList,"max-height":e.tableMaxHeight,fit:"",size:"small","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.$index},model:{value:e.selectedTemplate,callback:function(t){e.selectedTemplate=t},expression:"selectedTemplate"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"模板名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"protocol",label:"支持协议"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.protocol&&t.row.protocol.join(","))+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}})],1)],1)])],1)]),e._v(" "),a("div",{staticClass:"footer-wrapper"},[a("button",{staticClass:"button-plain",on:{click:e.handleCancelClick}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"button next-button",on:{click:e.handleNextClick}},[e._v("\n      下一步\n      "),e.doNext?a("button-loading"):e._e()],1)])])},[],!1,null,"330ff133",null);f.options.__file="PlcChoice.vue";var C=f.exports,g=a("YEIV"),b=a.n(g),_=a("gDS+"),k=a.n(_),y=a("oF3Q"),w=a.n(y),x=a("sk9p"),P=a.n(x),T={name:"PlcConfig",inject:["beforeClose"],components:{ButtonLoading:l.a},props:{configParams:{type:Object,required:!0},templateNames:{type:Array,required:!0},gateType:{type:String,required:!0},gateMac:{type:String,required:!0},completing:{type:Boolean,default:!1},showPrevious:{type:Boolean,required:!0}},data:function(){return{lastShowIndex:0,showTab:"",selectedProtocolList:[],protocolParamsList:[],activeTabParams:[],activeParams:[],templateName:"",completeMap:{},doComplete:this.completing,templateSaving:!1}},computed:{incompleteTabs:function(){var e=this;return r()(this.completeMap).map(function(t){return e.completeMap[t]?"":t}).filter(function(e){return e})}},watch:{configParams:function(e){this.initData(e)},completing:function(e){this.doComplete=e}},created:function(){this.initData(this.configParams)},methods:{initData:function(e){this.lastShowIndex=0,this.showTab="",this.selectedProtocolList=[],this.protocolParamsList=[];var t=!0,a=!1,i=void 0;try{for(var o,l=u()(w()(e));!(t=(o=l.next()).done);t=!0){var s=o.value,c=P()(s,2),n=c[0],r=c[1];this.selectedProtocolList.push(n),this.protocolParamsList.push(r),this.completeMap[n]=!0}}catch(e){a=!0,i=e}finally{try{!t&&l.return&&l.return()}finally{if(a)throw i}}this.showTab=this.selectedProtocolList[0],this.activeTabParams=this.protocolParamsList[0]},durationStyle:function(e){return{transition:300+80*Math.floor(e/4)+"ms"}},getProtocolParams:function(e){var t=[],a=!0,i=!1,o=void 0;try{for(var l,s=u()(e[0]);!(a=(l=s.next()).done);a=!0){var c=l.value;t.push(h()({},c,{value:"",selectedItem:""}))}}catch(e){i=!0,o=e}finally{try{!a&&s.return&&s.return()}finally{if(i)throw o}}return t},handleParamBluer:function(e,t,a){this.activeTabParams[e][t].value=a.target.value.trim()},handleTemplateBlur:function(e){this.templateName=e.target.value.trim()},handleTabClick:function(e,t){this.lastShowIndex!==t&&(this.showTab=e,this.protocolParamsList.splice(this.lastShowIndex,1,this.activeTabParams),this.checkTabComplete(this.activeTabParams,this.selectedProtocolList[this.lastShowIndex]),this.lastShowIndex=t,this.activeTabParams=this.protocolParamsList[t])},toggleItems:function(e){e.target.parentNode.parentNode.classList.toggle("hidden")},handleSelectChange:function(e,t,a,i){var o=h()({},t,{selectedItem:i}),l=this.activeTabParams[e];l.splice(a,1,o),this.activeTabParams.splice(e,1,l)},handleAddClick:function(){var e=this.getProtocolParams(this.activeTabParams);this.activeTabParams.splice(this.activeTabParams.length,0,e)},handlePreviousClick:function(){this.$emit("previous")},handleCancelClick:function(){this.$emit("cancel"),this.beforeClose()},handleCompleteClick:function(){if(this.doComplete=!0,this.checkComplete(),this.incompleteTabs.length)return this.$messageTips({type:"error",message:"协议没有配置完成"}),void(this.doComplete=!1);this.$emit("configComplete",this.buildConfigResult())},saveTemplate:function(){var e=this;if(this.templateSaving=!0,this.checkComplete(),this.incompleteTabs.length)return this.$messageTips({type:"error",message:"协议没有配置完成"}),void(this.templateSaving=!1);var t=this.templateName;if(!t)return this.$messageTips({type:"error",message:"请先输入模板名，方便下次直接调用"}),void(this.templateSaving=!1);if(this.templateNames.includes(t))return this.$messageTips({type:"error",message:"模板名重复，请重新输入"}),void(this.templateSaving=!1);var a=this.buildConfigResult(),i=h()({},{name:t,gateMac:this.gateMac,gateType:this.gateType,selectedProtocol:k()(this.selectedProtocolList),config:k()(a)});Object(c.o)(i).then(function(){e.$messageTips({message:"模板保存成功"}),e.templateSaving=!1,e.$emit("saveTemplate")}).catch(function(){e.templateSaving=!1})},buildConfigResult:function(){for(var e={},t=0,a=this.selectedProtocolList.length;t<a;t++)e[this.selectedProtocolList[t]]=this.protocolParamsList[t];return e},checkTabComplete:function(e,t){var a=void 0,i=!0,o=!1,l=void 0;try{for(var s,c=u()(e);!(i=(s=c.next()).done);i=!0){if(!(a=s.value.every(function(e){return 9!==e.required||(e.value||e.selectedItem)})))break}}catch(e){o=!0,l=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw l}}this.completeMap=h()({},this.completeMap,b()({},t,a))},checkComplete:function(){for(var e=0,t=this.selectedProtocolList.length;e<t;e++)this.checkTabComplete(this.protocolParamsList[e],this.selectedProtocolList[e])}}},L=(a("WGhr"),a("dnzZ"),Object(m.a)(T,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"config-container"},[a("button",{staticClass:"close-button",on:{click:e.handleCancelClick}},[a("i",{staticClass:"el-dialog__close el-icon-close"})]),e._v(" "),a("div",{staticClass:"tab-wrapper"},[e._l(e.selectedProtocolList,function(t,i){return a("button",{key:i,staticClass:"button-plain",class:{active:e.showTab===t,incomplete:e.incompleteTabs.includes(t)},on:{click:function(a){e.handleTabClick(t,i)}}},[e._v("\n      "+e._s(t)+"\n    ")])}),e._v(" "),a("div",{staticClass:"right-bg"})],2),e._v(" "),a("div",{staticClass:"content-wrapper modify-scroll-bar"},[e._l(e.activeTabParams,function(t,i){return a("div",{key:i,staticClass:"param-wrapper"},[e._l(t,function(t,i){return a("div",{key:i},["NAME"===t.param.toUpperCase()?a("div",{staticClass:"item-name",on:{click:e.toggleItems}},[e._v(e._s(t.value))]):e._e()])}),e._v(" "),a("div",{staticClass:"item-wrapper"},e._l(t,function(t,o){return a("div",{key:o,staticClass:"item",style:e.durationStyle(o)},[a("div",{staticClass:"label-wrapper"},[a("span",{staticClass:"label",class:{required:9===t.required}},[e._v(e._s(t.name))])]),e._v(" "),t.items.length?e._e():a("el-input",{on:{blur:function(t){e.handleParamBluer(i,o,t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"paramObject.value"}}),e._v(" "),t.items.length?a("el-select",{attrs:{value:t.selectedItem},on:{change:function(a){e.handleSelectChange(i,t,o,a)}}},e._l(t.items,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})):e._e()],1)}))],2)}),e._v(" "),a("div",{staticClass:"add-wrapper"},[a("div",{staticClass:"add",on:{click:e.handleAddClick}},[a("svg-icon",{staticClass:"plus-icon",attrs:{"icon-class":"plus-circle"}}),e._v(" "),a("span",{staticClass:"label"},[e._v("采集项")])],1)])],2),e._v(" "),a("div",{staticClass:"template-wrapper"},[a("div",{staticClass:"label"},[e._v("输入模板名:")]),e._v(" "),a("div",{staticClass:"value"},[a("el-input",{attrs:{maxlength:"50"},on:{blur:e.handleTemplateBlur},model:{value:e.templateName,callback:function(t){e.templateName=t},expression:"templateName"}})],1),e._v(" "),a("div",{staticClass:"save",on:{click:e.saveTemplate}},[e._v("\n      存为模板\n      "),e.templateSaving?a("button-loading"):e._e()],1)]),e._v(" "),a("div",{staticClass:"footer-wrapper"},[e.showPrevious?a("button",{staticClass:"button-plain",on:{click:e.handlePreviousClick}},[e._v("上一步")]):e._e(),e._v(" "),a("button",{staticClass:"button-plain",on:{click:e.handleCancelClick}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"button complete-button",on:{click:e.handleCompleteClick}},[e._v("\n      完成\n      "),e.doComplete?a("button-loading"):e._e()],1)])])},[],!1,null,"168a4f5c",null));L.options.__file="PlcConfig.vue";var S=L.exports,$={name:"CreatePlcDevice",provide:function(){return{beforeClose:this.handleDialogClose}},components:{TmTitle:o.a,ButtonLoading:l.a,PlcChoice:C,PlcConfig:S},directives:{focusEl:s.a},mixins:[i.a],data:function(){return{protocolList:[]}},methods:{fetchProtocolList:function(){var e=this,t={gateMac:this.gateMac,gateType:this.gateType};Object(c.i)(t).then(function(t){e.protocolList=t}).catch(function(e){})},handleChoiceClick:function(e){this.protocolList&&this.templateList&&this.doChoiceClick(e)}}},N=(a("d4uh"),a("oLOh"),Object(m.a)($,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"createContainer",staticClass:"create-device",staticStyle:{"min-height":"calc(100vh - 138px)"}},[a("tm-title",[a("span",{staticClass:"create-title"},[e._v("\n      建物影子\n      "),a("svg-icon",{staticClass:"question-icon",attrs:{"icon-class":"question",tips:"物影子是设备对应云端的映像"}})],1),e._v(" "),a("button",{staticClass:"button",on:{click:e.handleNewClick}},[a("svg-icon",{staticClass:"plus-icon",attrs:{"icon-class":"plus"}}),e._v("新建\n    ")],1)]),e._v(" "),a("div",{staticClass:"table-container create-device-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.deviceList,"max-height":e.tableMaxHeight,fit:"",size:"small","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"编号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.$index+1)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceName",label:"设备名称","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.deviceNameEditStatus[t.$index]?a("div",[a("el-input",{directives:[{name:"focus-el",rawName:"v-focus-el"}],key:"name"+t.$index,ref:"deviceName"+t.$index,attrs:{placeholder:"请输入设备名称",maxlength:"50"},on:{focus:function(a){e.handleDeviceNameFocus(t.$index)},blur:function(a){e.handleDeviceNameBlur(t.$index,t.row.deviceName)}},model:{value:t.row.deviceName,callback:function(a){e.$set(t.row,"deviceName",a)},expression:"scope.row.deviceName"}})],1):a("div",[e._v("\n            "+e._s(t.row.deviceName)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceCode",label:"设备编码","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.deviceCodeEditStatus[t.$index]?a("div",[a("el-input",{key:"code"+t.$index,attrs:{placeholder:"请输入设备编码",maxlength:"50"},on:{focus:function(a){e.handleDeviceCodeFocus(t.$index)},blur:function(a){e.handleDeviceCodeBlur(t.$index,t.row.deviceCode)}},model:{value:t.row.deviceCode,callback:function(a){e.$set(t.row,"deviceCode",a)},expression:"scope.row.deviceCode"}})],1):a("div",[e._v("\n            "+e._s(t.row.deviceCode)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceDesc",label:"设备描述","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.deviceDescEditStatus[t.$index]?a("div",[a("el-input",{key:"desc"+t.$index,attrs:{placeholder:"请输入设备描述"},on:{focus:function(a){e.handleDeviceDescFocus(t.$index)},blur:function(a){e.handleDeviceDescBlur(t.$index,t.row.deviceDesc)}},model:{value:t.row.deviceDesc,callback:function(a){e.$set(t.row,"deviceDesc",a)},expression:"scope.row.deviceDesc"}})],1):a("div",[e._v("\n            "+e._s(t.row.deviceDesc)+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"protocols",label:"协议","min-width":"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.protocols&&t.row.protocols.length?a("div",{staticClass:"protocol-cell",on:{click:function(a){e.handleChoiceClick(t.$index)}}},[e._v("\n            "+e._s(t.row.protocols.join(","))+"\n          ")]):a("div",{staticClass:"protocol-cell",on:{click:function(a){e.handleChoiceClick(t.$index)}}},[a("span",{staticClass:"label"},[e._v("选择协议/选择模板")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"采集项",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"item-cell",on:{click:function(a){e.handleConfigClick(t.$index)}}},[a("span",{staticClass:"label"},[e._v("\n              配置采集项\n              "),e.configLoadingShowStatus[t.$index]?a("button-loading"):e._e()],1)])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"operate-cell"},[a("svg-icon",{staticClass:"edit-icon",attrs:{"icon-class":"edit",tips:"编辑"},on:{click:function(a){e.handleRowEdit(t.$index)}}}),e._v(" "),a("svg-icon",{staticClass:"delete-icon",attrs:{"icon-class":"delete",tips:"删除"},on:{click:function(a){e.handleRowDelete(t.$index)}}})],1)]}}])})],1)],1),e._v(" "),a("div",{staticClass:"cancel-save-container"},[a("button",{staticClass:"button-plain",on:{click:e.handleCancelClick}},[e._v("取消")]),e._v(" "),a("button",{staticClass:"button ",on:{click:e.handleSaveClick}},[e._v("保存")])]),e._v(" "),a("el-dialog",{staticClass:"dnc-resolve-dialog",attrs:{visible:e.dialogShow,"before-close":e.handleDialogClose,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogShow=t}}},[a("div",{staticClass:"dnc-dialog-title",attrs:{slot:"title"},slot:"title"},[a("transition-group",{attrs:{name:e.panelTransitionName,mode:"out-in"}},[e.choiceShow?a("span",{key:"choice",staticClass:"step"},[e._v("选择协议或模板")]):e._e(),e._v(" "),e.configShow?a("span",{key:"config",staticClass:"step"},[e._v("配置采集项")]):e._e()])],1),e._v(" "),a("transition",{attrs:{name:e.panelTransitionName}},[e.choiceShow?a("plc-choice",{key:"choice"+e.latestIndex,attrs:{"protocol-list":e.protocolList,"template-list":e.templateList,"selected-protocol":e.selectedProtocol,"next-loading":e.nextLoading},on:{choiceComplete:function(t){e.handleChoiceComplete(t)}}}):e._e()],1),e._v(" "),a("transition",{attrs:{name:e.panelTransitionName}},[e.configShow?a("plc-config",{key:"config"+e.latestIndex,attrs:{"gate-mac":e.gateMac,"gate-type":e.gateType,"config-params":e.configParams,"template-names":e.templateNameList,completing:e.completing,"show-previous":e.configShowPrevious},on:{previous:e.handlePreviousClick,cancel:e.handleConfigCancelClick,saveTemplate:e.handleSaveTemplate,configComplete:e.handleConfigComplete}}):e._e()],1)],1)],1)},[],!1,null,"2696c80c",null));N.options.__file="CreatePlcDevice.vue";t.default=N.exports},VOl2:function(e,t,a){},Vf9A:function(e,t,a){},WGhr:function(e,t,a){"use strict";var i=a("lUh1");a.n(i).a},Zy2D:function(e,t,a){"use strict";var i=a("Vf9A");a.n(i).a},d4uh:function(e,t,a){"use strict";var i=a("VOl2");a.n(i).a},dnzZ:function(e,t,a){"use strict";var i=a("jrIa");a.n(i).a},gqEu:function(e,t,a){},jrIa:function(e,t,a){},lUh1:function(e,t,a){},oLOh:function(e,t,a){"use strict";var i=a("9p7l");a.n(i).a}}]);