(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-643d"],{"4gNM":function(e,t,i){"use strict";var c={name:"ButtonLoading"},n=(i("xWzq"),i("KHd+")),s=Object(n.a)(c,function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"loading-wrapper",on:{click:function(e){e.stopPropagation()}}},[t("i",{staticClass:"el-icon-loading"})])},[],!1,null,"bf374100",null);s.options.__file="ButtonLoading.vue";t.a=s.exports},AWzB:function(e,t,i){"use strict";var c=i("tBjC");i.n(c).a},"RU/L":function(e,t,i){i("Rqdy");var c=i("WEpk").Object;e.exports=function(e,t,i){return c.defineProperty(e,t,i)}},Rqdy:function(e,t,i){var c=i("Y7ZC");c(c.S+c.F*!i("jmDH"),"Object",{defineProperty:i("2faE").f})},SEkw:function(e,t,i){e.exports={default:i("RU/L"),__esModule:!0}},XWIM:function(e,t,i){"use strict";i.d(t,"h",function(){return n}),i.d(t,"d",function(){return s}),i.d(t,"j",function(){return o}),i.d(t,"f",function(){return a}),i.d(t,"g",function(){return l}),i.d(t,"i",function(){return d}),i.d(t,"l",function(){return u}),i.d(t,"b",function(){return r}),i.d(t,"e",function(){return h}),i.d(t,"k",function(){return f}),i.d(t,"o",function(){return v}),i.d(t,"m",function(){return p}),i.d(t,"n",function(){return g}),i.d(t,"a",function(){return m}),i.d(t,"c",function(){return D});var c=i("t3Un");function n(e){return Object(c.a)("/tm/gateinfo",e)}function s(e){return Object(c.a)("/tm/enable_gate",{gateMac:e})}function o(e){return Object(c.a)("/tm/get_MatterAnalysis",e)}function a(e){return Object(c.a)("/tm/get_deviceList",e)}function l(e){return Object(c.a)("/tm/get_protocols",e)}function d(e){return Object(c.a)("/tm/get_protocols",e)}function u(e){return Object(c.a)("/tm/get_templateList",e)}function r(e){return Object(c.a)("/tm/delete_device",e)}function h(e){return Object(c.a)("/tm/get_params_infos",e)}function f(e){return Object(c.a)("/tm/get_params_infos",e)}function v(e){return Object(c.a)("/tm/new_template",e)}function p(e){return Object(c.a)("/tm/new_device",e)}function g(e){return Object(c.a)("/tm/update_device ",e)}function m(e){return Object(c.a)("/tm/del_device",e)}function D(e){return Object(c.a)("/tm/dispatch",e)}},YEIV:function(e,t,i){"use strict";t.__esModule=!0;var c=function(e){return e&&e.__esModule?e:{default:e}}(i("SEkw"));t.default=function(e,t,i){return t in e?(0,c.default)(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}},ewrL:function(e,t,i){"use strict";t.a={inserted:function(e){document.querySelector(".el-input__inner").focus()}}},"gDS+":function(e,t,i){e.exports={default:i("oh+g"),__esModule:!0}},grZY:function(e,t,i){},"oh+g":function(e,t,i){var c=i("WEpk"),n=c.JSON||(c.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},qkoc:function(e,t,i){"use strict";var c=i("QbLZ"),n=i.n(c),s=i("gDS+"),o=i.n(s),a=i("m1cH"),l=i.n(a),d=i("P2sY"),u=i.n(d),r=i("X4fA"),h=i("XWIM"),f={data:function(){return{listLoading:!0,token:"",gateType:"",gateMac:"",deviceNameEditStatus:[],deviceDescEditStatus:[],deviceCodeEditStatus:[],configLoadingShowStatus:[],deviceList:[],tableMaxHeight:200,deviceCodeList:[],deviceNameList:[],unSaveDeviceNameList:[],deviceInitData:{deviceName:"",deviceCode:"",deviceDesc:""},latestIndex:0,latestDevice:{},selectedProtocol:null,configParams:null,templateList:null,templateNameList:[],dialogShow:!1,choiceShow:!1,configShow:!1,slidePanel:!1,panelTransitionName:"slide-left",configShowPrevious:!1,completing:!1,nextLoading:!1}},created:function(){var e=this;this.token=Object(r.a)(),this.gateType=this.$route.params.type,this.gateMac=this.$route.params.mac,this.$nextTick(function(){e.tableMaxHeight=e.$refs.createContainer.getBoundingClientRect().height-161}),this.getDeviceList(),this.fetchProtocolList(),this.fetchTemplateList()},methods:{getDeviceList:function(){var e=this,t={gateMac:this.gateMac,gateType:this.gateType};this.listLoading=!0,Object(h.f)(t).then(function(t){e.deviceList=t;var i=t.length;e.deviceNameEditStatus=new Array(i).fill(!1),e.deviceCodeEditStatus=new Array(i).fill(0),e.deviceDescEditStatus=new Array(i).fill(!1),e.configLoadingShowStatus=new Array(i).fill(!1),e.updateDeviceCodeNameList(),e.appendNewRow(),e.listLoading=!1}).catch(function(e){})},fetchTemplateList:function(){var e=this,t={gateMac:this.gateMac,gateType:this.gateType};Object(h.l)(t).then(function(t){e.templateList=t,e.templateNameList=t.map(function(e){return e.name})}).catch(function(e){})},handleDeviceNameFocus:function(e){this.updateLatest(e)},handleDeviceNameBlur:function(e,t){if(t=t.trim()){if(this.checkDeviceNameDuplicate(t))return this.latestDevice=u()({},this.latestDevice,{deviceName:""}),void this.updateDeviceList();this.deviceNameEditStatus.splice(e,1,!1)}this.latestDevice=u()({},this.latestDevice,{deviceName:t}),this.updateDeviceList(),e===this.deviceList.length-1&&(this.unSaveDeviceNameList[e]=t)},handleDeviceCodeFocus:function(e){this.updateLatest(e)},handleDeviceCodeBlur:function(e,t){if(t=t.trim()){if(this.checkDeviceCodeDuplicate(t))return this.latestDevice=u()({},this.latestDevice,{deviceCode:""}),void this.updateDeviceList();this.deviceCodeEditStatus.splice(e,1,!1)}this.latestDevice=u()({},this.latestDevice,{deviceCode:t}),this.updateDeviceList()},handleDeviceDescFocus:function(e){this.updateLatest(e)},handleDeviceDescBlur:function(e,t){this.deviceDescEditStatus.splice(e,1,!1),this.latestDevice=u()({},this.latestDevice,{deviceDesc:t.trim()}),this.updateDeviceList()},checkDeviceCodeDuplicate:function(e){var t=this.deviceCodeList.slice(0);if(t.splice(this.latestIndex,1),t.includes(e))return this.$messageTips({type:"error",message:"设备编码重复，请重新设置"}),!0},checkDeviceNameDuplicate:function(e){var t=this.deviceNameList.slice(0);t.splice(this.latestIndex,1);var i=this.unSaveDeviceNameList.slice(0);return i.splice(this.latestIndex,1),[].concat(l()(t),l()(i)).includes(e)?(this.$messageTips({type:"error",message:"设备名称重复，请重新设置"}),!0):(this.unSaveDeviceNameList[this.latestIndex]=e,!1)},handleNewClick:function(){this.appendNewRow()},appendNewRow:function(){var e=this;this.deviceList.push(this.deviceInitData),this.deviceNameEditStatus.push(!0),this.deviceCodeEditStatus.push(!0),this.deviceDescEditStatus.push(!0),this.configLoadingShowStatus.push(!1),this.$nextTick(function(){e.$refs["deviceName"+(e.deviceList.length-1)].focus(),e.deviceList[e.deviceList.length-1].deviceName=""})},deleteRow:function(e){this.deviceList.splice(e,1),this.deviceNameEditStatus.splice(e,1),this.deviceDescEditStatus.splice(e,1),this.deviceCodeEditStatus.splice(e,1),this.configLoadingShowStatus.splice(e,1),this.deviceCodeList.splice(e,1),this.deviceNameList.splice(e,1),this.unSaveDeviceNameList.splice(e,1)},handleRowEdit:function(e){var t=this;this.deviceNameEditStatus.splice(e,1,!0),this.deviceDescEditStatus.splice(e,1,!0),0!==this.deviceCodeEditStatus[e]&&this.deviceCodeEditStatus.splice(e,1,!0),this.$nextTick(function(){t.$refs["deviceName"+e].focus()})},handleRowDelete:function(e){var t=this;this.$confirm("确认删除该条物影子吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i={deviceCode:t.deviceList[e].deviceCode,gateType:t.gateType,gateMac:t.gateMac};Object(h.b)(i).then(function(){t.$messageTips({message:"删除物影子成功"}),t.deleteRow(e)}).catch(function(e){})}).catch(function(){})},doChoiceClick:function(e){this.updateLatest(e);var t=this.latestDevice,i=t.protocols,c=t.deviceName,n=t.deviceCode;this.verifyNameAndCode(c,n)&&(this.selectedProtocol=i||[],this.selectedProtocol.length&&(this.latestDevice=u()({},this.latestDevice,{oldProtocols:this.selectedProtocol,originalType:"protocol"}),this.updateDeviceList()),this.adjustPanelShowStatue({choice:!0}))},handleChoiceComplete:function(e){this.panelTransitionName="slide-left";var t=e.type,i=e.value;if("protocol"===t){var c=this.selectedProtocol.slice(),n=i.filter(function(e){return!c.includes(e)}),s=i.filter(function(e){return c.includes(e)}),o=c.filter(function(e){return!s.includes(e)});this.latestDevice=u()({},this.latestDevice,{protocols:i,oldProtocols:c,deleteProtocols:o,newProtocols:n,selectedTemplate:""})}if("template"===t){var a=this.templateList[i],l=a.name,d=a.protocol;this.latestDevice=u()({},this.latestDevice,{selectedTemplate:l,protocols:d})}this.updateDeviceList(),this.handleNextClick()},verifyNameAndCode:function(e,t){return e?!!t||(this.$messageTips({type:"error",message:"请先设置设备编码"}),!1):(this.$messageTips({type:"error",message:"请先设置设备名称"}),!1)},verifyTemplateAndProtocol:function(e,t){return!(!e&&(!t||t&&0===t.length))||(this.$messageTips({type:"error",message:"请先选择协议或模板"}),!1)},adjustPanelShowStatue:function(e){e.next&&(this.choiceShow=!1,this.configShow=!0),e.previous&&(this.choiceShow=!0,this.configShow=!1),e.config&&(this.dialogShow=!0,this.choiceShow=!1,this.configShow=!0),e.choice&&(this.dialogShow=!0,this.choiceShow=!0,this.configShow=!1)},openConfigPanelByConfig:function(){var e=this,t=this.latestDevice,i=t.selectedTemplate,c=t.protocols,n=t.deviceName,s=t.deviceCode;if(this.verifyNameAndCode(n,s)&&this.verifyTemplateAndProtocol(i,c)){this.configLoadingShowStatus.splice(this.latestIndex,1,!0),this.latestDevice=u()({},this.latestDevice,{oldProtocols:c,originalType:"protocol"}),this.updateDeviceList();var a={token:this.token,gateMac:this.gateMac,gateType:this.gateType,deviceCode:s,oldProtocols:o()(c),deleteProtocols:o()([]),newProtocols:o()([]),type:"protocol"};Object(h.e)(a).then(function(t){e.configParams=t,e.adjustPanelShowStatue({config:!0}),e.hideConfigLoading()}).catch(function(){e.hideConfigLoading()})}},openConfigPanelByNext:function(){var e=this,t=this.latestDevice,i=t.selectedTemplate,c=t.deviceCode,s={token:this.token,gateMac:this.gateMac,gateType:this.gateType,deviceCode:c};if(i){var a=n()({},s,{name:i,type:"template"});Object(h.k)(a).then(function(t){e.configParams=t,e.adjustPanelShowStatue({next:!0}),e.nextLoading=!1}).catch(function(){e.nextLoading=!1})}else{var l=this.latestDevice,d=l.oldProtocols,u=l.deleteProtocols,r=l.newProtocols,f=n()({},s,{oldProtocols:o()(d),deleteProtocols:o()(u),newProtocols:o()(r),type:"protocol"});Object(h.e)(f).then(function(t){e.configParams=t,e.adjustPanelShowStatue({next:!0}),e.nextLoading=!1}).catch(function(){e.nextLoading=!1})}},resetProtocol:function(){var e=this.latestDevice,t=e.oldProtocols,i=e.originalType;this.latestDevice="protocol"===i?u()({},this.latestDevice,{protocols:t}):u()({},this.latestDevice,{protocols:[]}),this.updateDeviceList()},handlePreviousClick:function(){this.resetProtocol(),this.panelTransitionName="slide-right",this.selectedProtocol=this.latestDevice.protocols,this.adjustPanelShowStatue({previous:!0})},handleNextClick:function(){this.configShowPrevious=!0,this.openConfigPanelByNext()},handleConfigClick:function(e){this.configShowPrevious=!1,this.updateLatest(e),this.openConfigPanelByConfig()},handleConfigComplete:function(e){var t=this;this.completing=!0;var i=this.latestDevice,c=i.protocols,n=i.deviceName,s=i.deviceCode,a=i.deviceDesc,l=u()({},{token:this.token,gateMac:this.gateMac,gateType:this.gateType,deviceName:n,deviceCode:s,deviceDesc:a,selectedProtocol:o()(c),config:o()(e)});Object(h.m)(l).then(function(){t.dialogClose(),t.$messageTips({message:"采集项配置已完成！"}),t.deviceCodeEditStatus.splice(t.latestIndex,1,0);var e=t.latestDevice.protocols;t.latestDevice=u()({},t.latestDevice,{isSaved:!0,oldProtocols:e,deleteProtocols:[],newProtocols:[],originalType:"protocol",selectedTemplate:""}),t.updateDeviceList(),t.fetchTemplateList(),t.deviceCodeList.splice(t.latestIndex,1,s),t.deviceNameList.splice(t.latestIndex,1,n),t.completing=!1,t.deviceList[t.deviceList.length-1].isSaved&&t.appendNewRow()}).catch(function(){t.completing=!1})},handleConfigCancelClick:function(){this.resetProtocol()},handleSaveTemplate:function(){this.fetchTemplateList()},hideConfigLoading:function(){this.configLoadingShowStatus.splice(this.latestIndex,1,!1)},handleCancelClick:function(){this.$router.push("/tm/dnc-resolve")},handleSaveClick:function(){var e=this,t=this.deviceList.map(function(t){if(t.deviceCode&&t.deviceName)return{gateMac:e.gateMac,deviceCode:t.deviceCode,deviceName:t.deviceName,deviceDesc:t.deviceDesc}}).filter(function(e){return e}),i={deviceInfo:o()(t)};Object(h.n)(i).then(function(){e.$messageTips({message:"保存成功!"}),setTimeout(function(){e.$router.push("/tm/dnc-resolve")},800)}).catch(function(e){})},updateDeviceCodeNameList:function(){var e=this;this.deviceCodeList=[],this.deviceNameList=[],this.unSaveDeviceNameList=[],this.deviceList.forEach(function(t){e.deviceCodeList.push(t.deviceCode),e.deviceNameList.push(t.deviceName)})},updateLatest:function(e){this.latestIndex=e,this.latestDevice=this.deviceList[this.latestIndex]},updateDeviceList:function(){this.deviceList.splice(this.latestIndex,1,this.latestDevice)},dialogClose:function(){this.dialogShow=!1,this.choiceShow=!1,this.configShow=!1,this.panelTransitionName="slide-left"},handleDialogClose:function(){var e=this;this.$confirm("确认取消更改吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.dialogClose()}).catch(function(){})}}};t.a=f},rci3:function(e,t,i){"use strict";var c={name:"TmTitle",props:{title:{type:String,default:""}}},n=(i("AWzB"),i("KHd+")),s=Object(n.a)(c,function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"title-container"},[this._t("default",[this._v(this._s(this.title))])],2)},[],!1,null,"32faa9a8",null);s.options.__file="TmTitle.vue";t.a=s.exports},tBjC:function(e,t,i){},xWzq:function(e,t,i){"use strict";var c=i("grZY");i.n(c).a}}]);